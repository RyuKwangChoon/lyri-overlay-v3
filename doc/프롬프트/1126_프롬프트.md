
./doc/í”„ë¡¬í”„íŠ¸/ì°¸ê³ ì†ŒìŠ¤ í´ë”ì— ìˆëŠ” ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì—…ì§€ì‹œì„œì˜ ìˆœì„œëŒ€ë¡œ ì‘ì—…ì„ ì§„í–‰í•˜ì„¸ìš”

---
## ğŸ§© ì‹ ì… ì‘ì—… ìˆœì„œ (ì‘ì—…ì—…ì§€ì‹œì„œ)

1ï¸âƒ£ server/.env ì¬ì •ë¹„ (server_v2_env í”„ë¡¬í”„íŠ¸)
- DB
- API_BASE_URL
- FFmpeg ê²½ë¡œ
- ì¸ì¦í‚¤

2ï¸âƒ£ server/index.js + /api + /ws â†’ v3 êµ¬ì¡°ë¡œ ë¦¬ë‰´ì–¼ (server_v2 + gate_v2 í”„ë¡¬í”„íŠ¸)

3ï¸âƒ£ client/.env + API ì—°ê²° ì •ë¦¬ (client_v2_env í”„ë¡¬í”„íŠ¸)

4ï¸âƒ£ vite.config.ts â†’ v3 ê¸°ì¤€ìœ¼ë¡œ ì¬ì‘ì„± (vite_config í”„ë¡¬í”„íŠ¸)

5ï¸âƒ£ OverlayView.vue / ControlView.vue / audioEngine.ts / nowPlaying.ts â†’ ì „ë¶€ v3 ì»´í¬ë„ŒíŠ¸ë¡œ êµì²´

âœ”ï¸ ë¼ˆëŒ€ ê·¸ëŒ€ë¡œ
âœ”ï¸ íŒŒì¼ë“¤ì€ ì™„ì „ êµì²´
âœ”ï¸ í´ë” êµ¬ì¡°ëŠ” ìœ ì§€
---





## ğŸŸ¦ 1) client_v2_env â†’ V3ìš© env.example ìƒì„± í”„ë¡¬í”„íŠ¸

```makefile
ë‹¹ì‹ ì€ Brian & Lyri Studioì˜ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤.
ì•„ë˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ Overlay V3 í”„ë¡œì íŠ¸ì˜ env.example íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.

ì°¸ê³  ìë£Œ:
- ê¸°ì¡´ client_v2_env
- gate_v2_env
- server_v2_env
- V3 ë§ˆìŠ¤í„° ê°€ì´ë“œ

ëª©í‘œ:
V3ì—ì„œëŠ” â€œOverlay / Gate / Relayâ€ê°€ ì™„ì „íˆ ë¶„ë¦¬ë˜ë¯€ë¡œ,
ê° ì»´í¬ë„ŒíŠ¸ê°€ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ í†µí•©í•œ env.example íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

í•„ìˆ˜ í¬í•¨ í•­ëª©:

# Overlay (Vite)
VITE_GATE_URL=
VITE_RELAY_URL=
VITE_WS_URL=
VITE_CDN_URL=
VITE_OVERLAY_VERSION=

# Gate
GATE_PORT=3001
RELAY_URL=
RELAY_TOKEN=
ALLOW_ORIGINS=

# Relay Server
SERVER_PORT=8787
DB_HOST=
DB_USER=
DB_PASSWORD=
DB_DATABASE=
DB_PORT=
JWT_SECRET=
LOG_LEVEL=

ì¶œë ¥ ìš”êµ¬ì‚¬í•­:
1) ì „ì²´ env.exampleë¥¼ ì™„ì „í•œ í˜•íƒœë¡œ ìƒì„±
2) ì£¼ì„ìœ¼ë¡œ ê¸°ëŠ¥ë³„ ì„¤ëª… í¬í•¨
3) V3 êµ¬ì¡° ê¸°ì¤€ìœ¼ë¡œ ì •ëˆëœ ìˆœì„œ
```

---
## ğŸŸ§ 2) gate_v2 â†’ V3ìš© gate.js ìƒì„± í”„ë¡¬í”„íŠ¸
```diff
ë‹¹ì‹ ì€ Brian & Lyri Studioì˜ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤.
ê¸°ì¡´ gate_v2 ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ Overlay V3ìš© gate.js(ê²Œì´íŠ¸ì›¨ì´ ì„œë²„)ë¥¼ ìƒˆë¡œ ì‘ì„±í•˜ì„¸ìš”.

ì—­í• :
GPT â†’ Gate â†’ Relay ë¡œ ì „ë‹¬ë˜ëŠ” ì¤‘ê³„ ì„œë²„
í…ìŠ¤íŠ¸/ì˜¤ë²„ë ˆì´ ë©”ì‹œì§€ ì „ë‹¬
ì‹¤íŒ¨ ì‹œ fallback ì €ì¥
í—¬ìŠ¤ ì²´í¬

í•„ìˆ˜ ê¸°ëŠ¥:

1) POST /fromGpt
- GPT ë©”ì‹œì§€ ìˆ˜ì‹ 
- role ë§¤í•‘(brian/assistant)
- Relay ì„œë²„ë¡œ POST /message/save ì „ë‹¬

2) Fallback
- Relay ì„œë²„ ì¥ì•  ì‹œ logs/unsent.json íŒŒì¼ì— ì €ì¥
- /resend-fallback ì—”ë“œí¬ì¸íŠ¸ë¡œ ì¬ì „ì†¡ ê°€ëŠ¥

3) Health Check
- GET /health
- GET /relay/ping
- GET /relay/health

4) ë³´ì•ˆ
- Bearer í† í° ê²€ì‚¬
- ALLOW_ORIGINS í—ˆìš©

5) env ì‚¬ìš©
GATE_PORT
RELAY_URL
RELAY_TOKEN
ALLOW_ORIGINS

ì¶œë ¥ ìš”êµ¬ì‚¬í•­:
- ì™„ì „ ë™ì‘í•˜ëŠ” gate.js í•˜ë‚˜ì˜ íŒŒì¼
- ES ëª¨ë“ˆ(ESM) ì‚¬ìš©
- ì½”ë“œ ì£¼ì„ í¬í•¨
- ê²½ë¡œ/í´ë” ì—†ìŒ, ì˜¤ì§ gate.js ë‚´ìš©ë§Œ ì¶œë ¥
```

---
## ğŸŸ¥ 3) server_v2 â†’ Relay server.js ìƒì„± í”„ë¡¬í”„íŠ¸
```diff
ë‹¹ì‹ ì€ Brian & Lyri Studioì˜ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤.
ê¸°ì¡´ server_v2 ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ Overlay V3ìš© relay server(server.js)ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

Relay Server ì—­í• :
- Overlayê°€ ì‚¬ìš©í•  REST API
- WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸
- NowPlaying ì›Œì»¤(3ì´ˆ ì£¼ê¸°)
- Track/Message/Ticker ì—…ë°ì´íŠ¸

í•„ìˆ˜ REST ì—”ë“œí¬ì¸íŠ¸:
POST /message/save
POST /notice/update
POST /tracks/update
POST /nowplaying/update
GET  /health

í•„ìˆ˜ WebSocket:
- í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì‹œ alive ping
- broadcast(event, payload) ìœ í‹¸ í•¨ìˆ˜ ì‘ì„±
- event type ì˜ˆ)
   overlay_message
   ticker_update
   now_playing_update
   track_order_changed

NowPlaying ì›Œì»¤:
- 3ì´ˆ ì£¼ê¸°
- íŠ¸ë™ ì¢…ë£Œ ì‹œ ë‹¤ìŒ íŠ¸ë™ ìë™ ì²˜ë¦¬
- repeat none/one/all ëª¨ë“œ ì§€ì›

env ë³€ìˆ˜:
SERVER_PORT
DB_*
LOG_LEVEL

ì¶œë ¥ ìš”êµ¬ì‚¬í•­:
- ì™„ì „í•œ server.js íŒŒì¼ í•˜ë‚˜ë¡œ ì¶œë ¥
- ESM ì‚¬ìš©
- MySQL/MariaDB Pool ì‚¬ìš©
- WSì™€ REST ëª¨ë‘ í¬í•¨
- ì£¼ì„ í¬í•¨
```

---

## ğŸŸ« 4) vite_config â†’ V3 vite.config.js ìƒì„± í”„ë¡¬í”„íŠ¸
```bash
ë‹¹ì‹ ì€ Brian & Lyri Studioì˜ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤.
ê¸°ì¡´ vite_config ë¬¸ì„œë¥¼ ì°¸ê³ í•´ Overlay V3 êµ¬ì¡°ì— ë§ì¶˜ vite.config.jsë¥¼ ì‘ì„±í•˜ì„¸ìš”.

ìš”êµ¬ì‚¬í•­:
1) alias
@ â†’ ./src
@components â†’ ./src/components
@modules â†’ ./src/modules
@views â†’ ./src/views
@layers â†’ ./src/layers
@store â†’ ./src/store
@assets â†’ ./src/assets

2) ì„œë²„ ì„¤ì •
port: 5173
open: false
strictPort: true
allowedHosts: Cloudflare Tunnel í—ˆìš©

3) Proxy
/fromGpt â†’ VITE_GATE_URL
/api     â†’ VITE_RELAY_URL

4) define
__GATE_URL__
__RELAY_URL__
__WS_URL__
__OVERLAY_VERSION__

5) build ì˜µì…˜
- chunkSizeWarningLimit: 1500
- manualChunks: node_modules â†’ vendor
- assetsDir: 'assets'
- outDir: 'dist'

6) í”ŒëŸ¬ê·¸ì¸
@vitejs/plugin-vue

ì¶œë ¥:
- ì™„ì „í•œ vite.config.js í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ì¶œë ¥
- ESM ë¬¸ë²•
- ì „ì²´ ì£¼ì„ í¬í•¨
```

---

## ğŸŸ© 5) V3 í´ë” êµ¬ì¡° ìŠ¤ìºí´ë”© í”„ë¡¬í”„íŠ¸
```diff
ë‹¹ì‹ ì€ Brian & Lyri Studioì˜ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤.
Overlay V3 í”„ë¡œì íŠ¸ì˜ í´ë” êµ¬ì¡°ë¥¼ ìŠ¤ìºí´ë”©í•˜ëŠ” ì—­í• ì„ ë§¡ì•˜ìŠµë‹ˆë‹¤.

ì•„ë˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì‹¤ì œ íŒŒì¼/í´ë” êµ¬ì¡°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ìŠ¤ìºí´ë”© ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶œë ¥í•˜ì„¸ìš”.

ìš”êµ¬ í´ë” êµ¬ì¡°:

src/
 â”œâ”€ components/
 â”‚    â”œâ”€ player/
 â”‚    â”œâ”€ tracklist/
 â”‚    â”œâ”€ overlay/
 â”œâ”€ modules/
 â”‚    â”œâ”€ audio/
 â”‚    â”œâ”€ ws/
 â”‚    â”œâ”€ api/
 â”œâ”€ layers/
 â”œâ”€ store/
 â”œâ”€ views/
 â”œâ”€ utils/
 â”œâ”€ assets/
 â”‚    â”œâ”€ images/
 â”‚    â”œâ”€ xmas/
 â”‚    â””â”€ decorations/
 â””â”€ app.vue
 â””â”€ main.js

ì¶œë ¥ ìš”êµ¬ì‚¬í•­:
- mkdir ëª…ë ¹ ê¸°ë°˜ ìŠ¤í¬ë¦½íŠ¸
- í´ë” ìƒì„± + placeholder íŒŒì¼ ìƒì„±
- ìœˆë„ìš°(cmd) + bash ë‘˜ ë‹¤ í˜¸í™˜ë˜ëŠ” í˜•íƒœ
- ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ ì¶œë ¥
```

- ì‘ì—…ì´ ì™„ë£Œëœ í›„ ./doc/Report í´ë” ì•„ë˜ì— ë‚ ì§œ_ì œëª©.md íŒŒì¼ë¡œ ì‘ì—… ê²°ê³¼ë¥¼ ë³´ê³ ì„œ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”


